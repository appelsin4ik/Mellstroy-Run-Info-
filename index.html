<!DOCTYPE html>
<!-- –í–ê–ñ–ù–û! –º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä ?v= –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ  -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="screen-orientation" content="portrait">
  <meta name="x5-orientation" content="portrait">

  <!-- Ultra-early handler: TikTok ‚Üí Chrome (Android), helper page on iOS -->
  <script>
  (function () {
    var ua = navigator.userAgent || "";
    var isAndroid = /Android/i.test(ua);
    var isIOS = /iPhone|iPad|iPod/i.test(ua);
    var isMobile = isAndroid || isIOS;
    var isTikTok = /(TikTok|TTWebView|Bytedance|ByteLocale)/i.test(ua);
    var isInstagram = /Instagram/i.test(ua);          // üëà –Ω–æ–≤—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä
    var isInApp     = isTikTok || isInstagram;        // üëà TikTok –ò–õ–ò Instagram
    var looksLikeIOSWebView = isIOS && /Safari\/\d+/i.test(ua) && !/Version\/\d+/i.test(ua);
    var already = /[?&]ttredir=1\b/.test(location.search);
    if (!isMobile || !isInApp || already) return;

    var targetUrl = location.href + (location.search ? "&" : "?") + "ttredir=1";

    if (isAndroid) {
      // –í—ã–≤–µ—Å—Ç–∏ –∏–∑ TikTok WebView –≤ Chrome
      var intent = "intent://" + targetUrl.replace(/^https?:\/\//, "") +
        "#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=" +
        encodeURIComponent(targetUrl) + ";end";
      location.replace(intent);

      // –ó–∞–ø–∞—Å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
      setTimeout(function(){ try{ location.href = targetUrl.replace(/^https?:\/\//,"googlechrome://"); }catch(e){} }, 800);
      setTimeout(function(){ location.href = targetUrl; }, 1600);
      return;
    }

    if (isIOS) {
      // iOS: –ø—Ä—è—á–µ–º –≤–≤–æ–¥ –∏–º–µ–Ω–∏/PLAY –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "Open in Safari".
      // –ü–æ –∫–ª–∏–∫—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞ "‚ãØ" (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö TikTok WebView).
      var u = location.href + (location.search ? "&" : "?") + "ttredir=1";
      document.documentElement.classList.add('tt-ios');

      // —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å—Ç—Ä–µ–ª–∫–∏ (–≤—Å—Ç–∞–≤–∏–º –æ–¥–∏–Ω —Ä–∞–∑)
      (function injectStyles(){
        if (document.getElementById('ttIosStyles')) return;
        var st = document.createElement('style');
        st.id = 'ttIosStyles';
        st.textContent = `
          @keyframes tt-bob { 0%,100% { transform: translate(0,0) } 50% { transform: translate(-3px,3px) } }
          @keyframes tt-pulse { 0%,100% { opacity: .9 } 50% { opacity: 1 } }
        `;
        document.head.appendChild(st);
      })();

      document.addEventListener('DOMContentLoaded', function () {
        // —Å–ø—Ä—è—á–µ–º –∏–º—è –∏ PLAY
        var inputWrapper = document.getElementById('inputWrapper');
        var playWrapper  = document.getElementById('playBtnWrapper');
        if (inputWrapper) inputWrapper.style.display = 'none';
        if (playWrapper)  playWrapper.style.display  = 'none';

        // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–µ–Ω—é
        var menuContent = document.querySelector('.menuContent') || document.getElementById('menu') || document.body;

        // –±–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π
        var box = document.createElement('div');
        box.id = 'ttIosOpenInSafari';
        box.style.marginTop = '12px';
        box.style.display = 'flex';
        box.style.flexDirection = 'column';
        box.style.alignItems = 'center';
        box.style.gap = '10px';
        box.innerHTML = `
          <button id="openSafariBtn"
            style="
              font-family:'Press Start 2P', monospace;
              font-size:16px; letter-spacing:1px;
              color:#fff; background:#0ea5e9;
              border:0; border-radius:10px;
              padding:12px 18px; cursor:pointer;
              box-shadow:0 0 12px rgba(14,165,233,.6);
            ">
            Open in Safari
          </button>
          <div style="max-width:90vw; opacity:.75; font-size:12px; line-height:1.5; text-align:center;">
            –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Safari –Ω–∞–ø—Ä—è–º—É—é, –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –≥–¥–µ –Ω–∞–∂–∞—Ç—å <b>‚ãØ</b> –∏ –≤—ã–±—Ä–∞—Ç—å ¬´–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ¬ª.
          </div>
        `;
        menuContent.appendChild(box);

        // –ø–æ –Ω–∞–∂–∞—Ç–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É-–ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞ –ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö
        document.getElementById('openSafariBtn').addEventListener('click', function () {
          // –Ω–µ –ø—ã—Ç–∞–µ–º—Å—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å Safari (iOS —ç—Ç–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç) ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
          var overlay = document.createElement('div');
          overlay.id = 'ttOpenHint';
          overlay.style.cssText = `
            position:fixed; inset:0; z-index:99999;
            pointer-events:none;  /* –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–µ ‚ãØ */
          `;

          // –±–ª–æ–∫ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
          var hint = document.createElement('div');
          hint.style.cssText = `
            position:absolute; top:10px; right:12px;
            display:flex; flex-direction:column; align-items:flex-end; gap:8px;
            pointer-events:none;
          `;

          // "—Å—Ç—Ä–µ–ª–∫–∞" (–±–æ–ª—å—à–∞—è ‚ÜóÔ∏è —Å –ª—ë–≥–∫–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ–º)
          var arrow = document.createElement('div');
          arrow.textContent = '‚ÜóÔ∏è';
          arrow.style.cssText = `
            font-size:44px; line-height:1;
            animation: tt-bob 1.1s ease-in-out infinite, tt-pulse 1.8s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255,255,255,.6));
          `;

          // –ø–ª–∞—à–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
          var bubble = document.createElement('div');
          bubble.innerHTML = `–ù–∞–∂–º–∏ <b>‚ãØ</b> –∏ –≤—ã–±–µ—Ä–∏ <b>–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ</b>`;
          bubble.style.cssText = `
            max-width: 240px;
            background: rgba(0,0,0,.78);
            color:#fff; padding:8px 10px; border-radius:10px;
            font: 14px/1.25 'VT323', monospace; text-align:right;
            box-shadow: 0 0 10px rgba(0,0,0,.35);
          `;

          hint.appendChild(arrow);
          hint.appendChild(bubble);
          overlay.appendChild(hint);
          document.body.appendChild(overlay);

          // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±—Ä–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥
          setTimeout(function(){
            if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);
          }, 7000);
        });
      });
      // –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ iOS-—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã/document.write
      return;
    }
  })();
  </script>

  <title>Mellstroy Run ‚Äì –±–µ–∑—É–º–Ω–∞—è –æ–Ω–ª–∞–π–Ω –±—Ä–∞—É–∑–µ—Ä–Ω–∞—è –∏–≥—Ä–∞</title>
  <link rel="canonical" href="https://mellstroy-run.com/">
  <meta name="description" content="Mellstroy Run ‚Äî –±–µ–∑—É–º–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: –±–µ–≥–∏, —É–≤–æ—Ä–∞—á–∏–≤–∞–π—Å—è –æ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π, —Å–æ–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç—ã, –∫—Ä—É—Ç–∏ —Å–ª–æ—Ç—ã –∏ –ø–æ–ø–∞–¥–∏ –≤ —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤. –ò–≥—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –Ω–∏—á–µ–≥–æ —Å–∫–∞—á–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.">
  <link rel="icon" type="image/png" href="assets/images/logo.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- side banners -->
  <div class="side-banner side-banner-left">
    <div class="light-banner">
      <div class="neon-text" data-text="MELLSTROY GAME"></div>
          <a class="banner-link" href="https://mellstroy.club" target="_blank" title="Visit Mellstroy Game">
          <img src="assets/images/mellstroy_game.png" alt="Mellstroy Game" />
    </a>
    </div>
  </div>

    <!-- TikTok icon below left banner -->
  <div class="tiktok-under-banner left">
    <a href="https://www.tiktok.com/@mellstroy.run.gam" target="_blank" title="–ü–µ—Ä–µ—Ö–æ–¥–∏!">
      <div class="tiktok-box">
        <img src="assets/images/tiktok.svg" alt="TikTok" class="tiktok-icon" />
        <span class="tiktok-label">–ú—ã –≤ TikTok</span>
      </div>
    </a>
  </div>

  <div class="side-banner side-banner-right">
    <div class="light-banner">
      <div class="neon-text" data-text="MELLSTROY GAME"></div>
          <a class="banner-link" href="https://mellstroy.club" target="_blank" title="Visit Mellstroy Game">
          <img src="assets/images/mellstroy_game.png" alt="Mellstroy Game" />
    </a>
    </div>
  </div>

    <!-- TikTok icon below right banner -->
  <div class="tiktok-under-banner right">
    <a href="https://www.tiktok.com/@mellstroy.run.gam" target="_blank" title="–ü–µ—Ä–µ—Ö–æ–¥–∏!">
      <div class="tiktok-box">
        <img src="assets/images/tiktok.svg" alt="TikTok" class="tiktok-icon" />
        <span class="tiktok-label">–ú—ã –≤ TikTok</span>
      </div>
    </a>
  </div>


  <div id="menu">
      <div class="menuContent">
        <div id="logoWrapper">
            <div class="logoScale">
              <img id="titleImage" src="assets/images/logo_final_take.png" alt="Mellstroy Run Logo">
            </div>
          <img class="coinGif" id="coinRight" src="assets/images/coin.gif" alt="Coin Right">
          <img class="coinGif" id="coinLeft" src="assets/images/coin.gif" alt="Coin Left">
        </div>

        <div id="inputWrapper">
          <input type="text" id="playerNameInput" placeholder="Enter your Name" maxlength="12">
          <div id="nameError"></div>
        </div>

        <div id="playBtnWrapper">
          <button id="playBtn">‚ñ∂ PLAY</button>
        </div>
      </div>
  </div>

  <div id="container">
    <h1 id="gameTitle">MELLSTROY RUN</h1>
    <canvas id="game" width="800" height="300"></canvas>

    <div id="hud">
      <div id="scoreDisplay">üèÜ 0</div>
      <div id="coinDisplay">ü™ô coming soon!</div>
    </div>

    <div id="finalScoreDisplay"></div>

    <button id="restart">Restart</button>
    <button id="gameMenuBtn">Menu</button>
    <button id="shopBtn">üõí –ü—Ä–∏–ª–∞–≤–æ–∫</button>

    <div id="sideContentWrapper">
      <div id="slotMachineContainer">
        <h3><a class="brand-link" href="https://mellstroy.club" target="_blank" rel="noopener noreferrer">üé∞ MELLSTROY GAME üé∞</a></h3>
        <!-- –Ω–æ–≤–æ–µ ¬´–æ–∫–Ω–æ¬ª —Å–æ —Å—Ç–æ–ª–±—Ü–∞–º–∏-–±–∞—Ä–∞–±–∞–Ω–∞–º–∏ -->
        <div class="slot-window">
          <div class="doors" id="slotDoors">
            <div class="door"><div class="boxes"></div></div>
            <div class="door"><div class="boxes"></div></div>
            <div class="door"><div class="boxes"></div></div>
          </div>

          <!-- NEW: –ª–∞–º–ø—ã –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É .doors -->
          <div id="bulbFrame" class="bulb-frame">
            <div class="side top"></div>
            <div class="side right vertical"></div>
            <div class="side bottom"></div>
            <div class="side left vertical"></div>
          </div>

          <div class="slot-glass" aria-hidden="true"></div>
        </div>
        <button id="spinBtn">–ö–†–£–¢–ò–¢–¨ –ó–ê 1ü™ô (3/3)</button>
        <div id="slotMessage">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å!</div>
      </div>

      <div id="leaderboardContainer">
        <h3>üèÜ –¢–û–ü-10 –ò–ì–†–û–ö–û–í üèÜ</h3>
        <ul id="leaderboardList">
          <li>Loading...</li>
        </ul>

              <!-- üëá Add this right before closing </div> of #container -->
        <div class="tiktok-under-banner center-touch">
          <a href="https://www.tiktok.com/@mellstroy.run.gam" target="_blank" title="Watch on TikTok!">
            <div class="tiktok-box">
              <img src="assets/images/tiktok.svg" alt="TikTok" class="tiktok-icon" />
              <span class="tiktok-label">–ú—ã –≤ TikTok</span>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shopOverlay">
    <div id="shopContainer">
      <button id="closeShopBtn">‚úñ</button>
      <h2>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h2>
      <div id="skinsRow"></div>
    </div>
  </div>

  <audio id="gameMusic" src="assets/sounds/main_music.mp3" loop></audio>
  <audio id="introSound" src="assets/sounds/intro.mp3"></audio>
  <!-- –í–ê–ñ–ù–û! –º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä ?v= –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ  -->
  <script src="game.js?v=7" defer></script>
  <div id="toastContainer"></div>
</body>
</html>
